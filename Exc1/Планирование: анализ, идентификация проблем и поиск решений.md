**Задание 1. Анализ, идентификация проблем и решений, планирование**

# **Существующие и потенциальные проблемы**

- Проблемная производительность MES API (External API) для функционала операторов. Низкая скорость отображения заказов для операторов и External API для B2C.
- Shop API и CRM API работают с одной базой данных ShopDB, что является антипаттерном для микросервисов. Это может привести к проблемам с масштабируемостью, неявным зависимостям и трудностям с параллельной работой различных команд (учитывая возможность набора новых сотрудников).
- Долгие релизы и критические баги. Низкая скорость релизов указывает на возможные проблемы с архитектурой, напоминающей монолитную систему.
- Нарушение принципа единственной точки входа (Single Point of Responsibility, SPR). Несколько точек входа для создания заказа размывают зоны ответственности. Заказ поступает как из CRM API, так и в CRM API из очереди, хотя основной системой должна быть MES (Manufacturing Execution System).
- Отсутствие 

## **Инициативы для устранения нежелательных ситуаций (в порядке приоритета)**

1. **Фактообоснованное решение**. По предварительным расчётам, проблема заключается в сервисе MES, который замедляет другие процессы. Необходимо обосновать это средствами мониторинга. Можно начать с простого анализа лог-файлов, параллельно внедряя более сложные инструменты наблюдения за всей системой через единую точку сбора и трассировки.
   
2. **Ревизия и внедрение кэширования на стороне MES UI-клиентов**, чтобы минимизировать проблему с минимальными усилиями в кратчайшие сроки. Этот компромисс означает небольшой процент отказов при создании нового заказа, если другой оператор уже начал работать с ним, однако он «разблокирует» общую работу.

3. **Создание отдельного ACL-сервиса для кэширования** (Read-Through + Write-Through), работающего как обратный прокси-сервер, который будет кэшировать заказы для операторов и обновлять кэш при изменении статуса заказа оператором. Это сведёт к минимуму ситуацию, когда два оператора одновременно начинают работу с одним заказом.

4. **Улучшение производительности MES API** посредством более сложных механизмов кэширования, включая отслеживание изменений состояний заказов в топиках, что позволит улучшить взаимодействие с B2C.

5. **Выделение расчёта стоимости заказа в отдельный сервис** для независимой масштабируемости этой функции.

6. **Разделение базы данных ShopDB** для выделения отдельной CRM DB для CRM API.

## **Обоснование трёх главных инициатив и архитектура через полгода**

### **Общие расчёты**

При линейном росте нагрузки (например, 100 дополнительных заказов ежемесячно в течение года), нагрузка составит $N + 12 \times 100 = N + 1200$, что считается относительно низким показателем по современным стандартам. Например, за десять лет нагрузка вырастет примерно до 120 000 заказов в месяц (~400 заказов в день).

### **Расчёты стоимости заказа и 3D-модели**

На основании модели MES расчёт стоимости заказа занимает от 2 до 3 минут в среднем, максимум — 30 минут. В среднем это означает около одних суток на обработку заказа, в худшем случае — три дня.

### **Хранилища для 3D-моделей**

Если предположить, что используются модели высокого разрешения (~50 МБ каждая), то объём данных за месяц составит $400 \times 50$ МБ ≈ 20 ГБ. За год это даст около 240 ГБ, а за десять лет — 2,4 ТБ. Эти объёмы считаются приемлемыми, учитывая использование облачных SaaS-решений, таких как Yandex Cloud S3.

### **Обоснование**

Учитывая частые проблемы с релизами («задержки раньше не превышали одного месяца, но теперь требуют всё больше времени»), первые три инициативы предложены как быстрые решения для достижения немедленных результатов и выигрыша времени для дальнейшей оптимизации производительности.

Внедрение кэширования на клиентской стороне потребует минимальных изменений кода MES. Это можно реализовать с помощью HTTP-прокси, настроенного, например, через Nginx. Далее, внедрение ACL поможет создать базу для стабильной работы с B2C и перехода к четвёртому этапу, требующему более длительной разработки.

В общем, выполнение перечисленных инициатив в условиях текущей инфраструктуры компании займёт около полугода до стабилизации платформы.